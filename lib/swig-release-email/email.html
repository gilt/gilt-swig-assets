<style>
  /* this css is inlined into the html below before it is sent as email content */
  h2 { font-size: 18px; padding: 8px 10px; margin: 10px 0; background: #f7f7f7; border: 1px solid #ddd; border-radius: 3px; font-weight: bold; color: #333; text-shadow: 0 1px rgba(255,255,255,0.5); }
  h3 { font-size: 13px; padding-left: 10px; }

  .fileList { font: 12px Helvetica, Arial; padding: 10px 20px; max-width: 800px; vertical-align: middle; }
  .fileList td { border-top: 1px solid #eee; }
  .fileList tr:first-child td { border: 0; }
  .fileList a { padding-right: 10px; font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace; }
  .fileList .fileName { padding: 4px 0; }
  .fileList .additions { color: #55a532; font-weight: bold; padding: 6px 0 0 0; }
  .fileList .deletions { color: #bd2c00; font-weight: bold; padding: 6px 0 0 4px; }
  .fileList .graph { padding: 4px 0 4px 10px; white-space: nowrap; }

  h4 {
    font: 12px Helvetica, Arial;
    line-height: 1.4em;
    padding: 10px 20px;
  }

  .graph { font-size: 0; font-size: 18px; }
  .graph .add { color: #55a532; }
  .graph .del { color: #bd2c00; }
  .graph .norm { color: #ddd; }

  .fileHeader {
    background-color: #f7f7f7;
    border: 1px solid #ddd;
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    font: 13px Helvetica, Arial;
    line-height: 28px;
    margin: 20px 20px 0 20px;
    max-width: 720px;
    padding: 0 10px;
    text-shadow: 0 1px 0 #fff;
  }
  .fileHeader .total {
    color: #666;
    font-size: 11px;
    font-weight: bold;
  }
  .fileHeader .name {
    letter-spacing: 0.3px;
    padding-left: 20px;
  }

  .diff {
    border: 1px solid #ddd;
    border-top: 0;
    border-bottom-left-radius: 3px;
    border-bottom-right-radius: 3px;
    margin: 0 20px 15px 20px;
    max-width: 740px;
    overflow-x: auto;
    overflow-y: hidden;
  }
  .diff table {
    color: #333;
    font-size: 12px;
    overflow: visible;
    vertical-align: middle;
    white-space: pre;
    width: 100%;
  }
  .diff table td { padding: 4px 10px; font-family: Consolas, Courier; }
  .diff table td:last-child { border-right: 0; }
  .diff table .line { min-widght: 50px; text-align: right; color: rgba(0,0,0,0.3); }
  .diff table tr.normal .line { border-right: 1px solid #eee; }
  .diff table tr.add { background-color: #eaffea; }
  .diff table tr.add .line { background: #dbffdb; border-right: 1px solid #c1e9c1; }
  .diff table tr.del { background-color: #ffecec; }
  .diff table tr.del .line { background: #ffdddd; border-right: 1px solid #f1c0c0; }
  .diff table tr.chunk { border-right: 1px solid #d5e4f2; background-color: #f8fafd; }
  .diff table tr.chunk td { color: rgba(0,0,0,0.3); }
  .diff table tr.chunk .line { background: #f0f5fa; border-right: 1px solid #d5e4f2; }
</style>

<h2>Published ui-tracking module "tracking_api.signal" v1.0.2 - v2.0.0</h2>

<h3>Showing 3 changed files with 116 additions and 73 deletions.</h3>

<table cellpadding="0" cellspacing="0" border="0" class="fileList">
<tbody>
  <tr>
    <td class="fileName" width="100%"><a href="#src/tracking_api/signal/js/signal.js"><span>src/tracking_api/signal/js/signal.js</span></a></td>
    <td class="additions">+46</td>
    <td class="deletions">-49</td>
    <td class="graph">
      <span class="add">■</span><span class="add">■</span><span class="del">■</span><span class="del">■</span><span class="del">■</span>
    </td>
  </tr>
  <tr>
    <td class="fileName" width="100%"><a href="#src/tracking_api/signal/package.json"><span>src/tracking_api/signal/package.json</span></a></td>
    <td class="additions">+3</td>
    <td class="deletions">-2</td>
    <td class="graph">
      <span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="del">■</span><span class="del">■</span>
    </td>
  </tr>
  <tr>
    <td class="fileName" width="100%"><a href="#src/tracking_api/signal/spec/signal.js"><span>src/tracking_api/signal/spec/signal.js</span></a></td>
    <td class="additions">+67</td>
    <td class="deletions">-22</td>
    <td class="graph">
      <span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="del">■</span>
    </td>
  </tr>
</tbody>
</table>

<h3>Commits</h3>

<h4>
commit <a href="https://gerrit.gilt.com/gitweb.cgi?p=ui-tracking.git;a=commit;h=252b12de6a9ff7410564bc1073386b69a66d27be">252b12de6a9ff7410564bc1073386b69a66d27be</a><br/>Author: <strong>Eric Shepherd </strong>&lt;<a href="mailto:eshepherd@gilt.com">eshepherd@gilt.com</a>&gt;<br/>Date: <strong>  Mon Jan 26 20:00:28 2015 -0500<br/><br/>    </strong><a href="https://jira.gilt.com/browse/PERF-134">PERF-134</a>: Rewrite tracking_api.signal<br/>    <br/>    There's now a race condition because of the signal_direct code,<br/>    which loads both Signal scripts. When the remote code loads before<br/>    the tracking_api.signal module is ready for it, events start to<br/>    fire from the dashboard before the client module has data.<br/>    <br/>    There is a new dependency on signal from signal_direct. This is not<br/>    what I think is ideal, since the two should be relatively<br/>    independent, but it acknowledges the fact that signal_direct really<br/>    can't load the shared third-party script until the data and all is<br/>    wired up in the signal module.<br/>    <br/>    Change-Id: <a href="https://gerrit.gilt.com/#/q/Ia4fef47aa887606b7fb0a06d804bb17b090f90e9,n,z">Ia4fef47aa887606b7fb0a06d804bb17b090f90e9</a><br/>    Reviewed-on: <a href="https://gerrit.gilt.com/57188">https://gerrit.gilt.com/57188</a><br/>    Reviewed-by: Eric Shepherd &lt;<a href="mailto:eshepherd@gilt.com">eshepherd@gilt.com</a>&gt;<br/>    Tested-by: Eric Shepherd &lt;<a href="mailto:eshepherd@gilt.com">eshepherd@gilt.com</a>&gt;<br/>
</h4>

<h3>Files</h3>

<a name="src&#x2F;tracking_api&#x2F;signal&#x2F;js&#x2F;signal.js"></a>
<div class="fileHeader">
  <span class="total">95</span>
  <span class="graph" title="46 additions & 49 deletions">
    <span class="add">■</span><span class="add">■</span><span class="del">■</span><span class="del">■</span><span class="del">■</span>
  </span>
  <span class="name">src&#x2F;tracking_api&#x2F;signal&#x2F;js&#x2F;signal.js</span>
</div>
<div class="diff">
  <table cellpadding="0" cellspacing="0" border="0">
  <tbody>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -15,12 +15,14 @@ createModule('tracking_api.signal',</td>
    </tr>
    <tr class="normal">
      <td class="line">15</td>
      <td class="line">15</td>
      <td class="content">   'config.signal_script_uri',</td>
    </tr>
    <tr class="normal">
      <td class="line">16</td>
      <td class="line">16</td>
      <td class="content">   'config.signal_direct_site_id',</td>
    </tr>
    <tr class="normal">
      <td class="line">17</td>
      <td class="line">17</td>
      <td class="content">   'vendor.underscore',</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">18</td>
      <td class="content">+  'vendor.when',</td>
    </tr>
    <tr class="normal">
      <td class="line">18</td>
      <td class="line">19</td>
      <td class="content">   'common.ab_test',</td>
    </tr>
    <tr class="normal">
      <td class="line">19</td>
      <td class="line">20</td>
      <td class="content">   'common.logger'</td>
    </tr>
    <tr class="normal">
      <td class="line">20</td>
      <td class="line">21</td>
      <td class="content"> ],</td>
    </tr>
    <tr class="normal">
      <td class="line">19</td>
      <td class="line">20</td>
      <td class="content">   'common.logger'</td>
    </tr>
    <tr class="normal">
      <td class="line">20</td>
      <td class="line">21</td>
      <td class="content"> ],</td>
    </tr>
    <tr class="normal">
      <td class="line">21</td>
      <td class="line">22</td>
      <td class="content"> </td>
    </tr>
    <tr class="del">
      <td class="line">22</td>
      <td class="line"></td>
      <td class="content">-function (scriptUri, directSiteId, _, abTest, Logger) {</td>
    </tr>
    <tr class="del">
      <td class="line">23</td>
      <td class="line"></td>
      <td class="content">-  var log = new Logger('tracking_api.signal');</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">23</td>
      <td class="content">+function (scriptUri, directSiteId, _, when, abTest, Logger) {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">24</td>
      <td class="content">+  var</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">25</td>
      <td class="content">+    log = new Logger('tracking_api.signal');</td>
    </tr>
    <tr class="normal">
      <td class="line">24</td>
      <td class="line">26</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">25</td>
      <td class="line">27</td>
      <td class="content">   /**</td>
    </tr>
    <tr class="normal">
      <td class="line">26</td>
      <td class="line">28</td>
      <td class="content">    * Appends the Signal Direct script (see tracking_api.signal_direct)</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -65,8 +67,9 @@ function (scriptUri, directSiteId, _, abTest, Logger) {</td>
    </tr>
    <tr class="normal">
      <td class="line">65</td>
      <td class="line">67</td>
      <td class="content">     init        : _.once(init),</td>
    </tr>
    <tr class="normal">
      <td class="line">66</td>
      <td class="line">68</td>
      <td class="content">     createEvent : function () {},</td>
    </tr>
    <tr class="normal">
      <td class="line">67</td>
      <td class="line">69</td>
      <td class="content">     fireEvent   : function () {},</td>
    </tr>
    <tr class="del">
      <td class="line">68</td>
      <td class="line"></td>
      <td class="content">-    ready       : function () {},</td>
    </tr>
    <tr class="del">
      <td class="line">69</td>
      <td class="line"></td>
      <td class="content">-    getData     : function () { return ''; }</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">70</td>
      <td class="content">+    tagReady    : function () {},</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">71</td>
      <td class="content">+    getData     : function () { return ''; },</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">72</td>
      <td class="content">+    ready       : when.resolve()</td>
    </tr>
    <tr class="normal">
      <td class="line">70</td>
      <td class="line">73</td>
      <td class="content">   };</td>
    </tr>
    <tr class="normal">
      <td class="line">71</td>
      <td class="line">74</td>
      <td class="content"> },</td>
    </tr>
    <tr class="normal">
      <td class="line">72</td>
      <td class="line">75</td>
      <td class="content"> </td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -90,6 +93,7 @@ createModule('tracking_api.signal',</td>
    </tr>
    <tr class="normal">
      <td class="line">90</td>
      <td class="line">93</td>
      <td class="content">   'config.signal_direct_site_id',</td>
    </tr>
    <tr class="normal">
      <td class="line">91</td>
      <td class="line">94</td>
      <td class="content">   'vendor.underscore',</td>
    </tr>
    <tr class="normal">
      <td class="line">92</td>
      <td class="line">95</td>
      <td class="content">   'vendor.jquery',</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">96</td>
      <td class="content">+  'vendor.when',</td>
    </tr>
    <tr class="normal">
      <td class="line">93</td>
      <td class="line">97</td>
      <td class="content">   'common.ab_test',</td>
    </tr>
    <tr class="normal">
      <td class="line">94</td>
      <td class="line">98</td>
      <td class="content">   'common.logger',</td>
    </tr>
    <tr class="normal">
      <td class="line">95</td>
      <td class="line">99</td>
      <td class="content">   'common.page_controller',</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -102,6 +106,7 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">102</td>
      <td class="line">106</td>
      <td class="content">   directSiteId,</td>
    </tr>
    <tr class="normal">
      <td class="line">103</td>
      <td class="line">107</td>
      <td class="content">   _,</td>
    </tr>
    <tr class="normal">
      <td class="line">104</td>
      <td class="line">108</td>
      <td class="content">   $,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">109</td>
      <td class="content">+  when,</td>
    </tr>
    <tr class="normal">
      <td class="line">105</td>
      <td class="line">110</td>
      <td class="content">   abTest,</td>
    </tr>
    <tr class="normal">
      <td class="line">106</td>
      <td class="line">111</td>
      <td class="content">   Logger,</td>
    </tr>
    <tr class="normal">
      <td class="line">107</td>
      <td class="line">112</td>
      <td class="content">   pageController,</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -109,14 +114,15 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">109</td>
      <td class="line">114</td>
      <td class="content"> ) {</td>
    </tr>
    <tr class="normal">
      <td class="line">110</td>
      <td class="line">115</td>
      <td class="content">   var</td>
    </tr>
    <tr class="normal">
      <td class="line">111</td>
      <td class="line">116</td>
      <td class="content">     NAMESPACE      = 'signal',</td>
    </tr>
    <tr class="del">
      <td class="line">112</td>
      <td class="line"></td>
      <td class="content">-    initialized    = false,</td>
    </tr>
    <tr class="del">
      <td class="line">113</td>
      <td class="line"></td>
      <td class="content">-    signalReady    = false,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">117</td>
      <td class="content">+    readyDfd       = when.defer(),</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">118</td>
      <td class="content">+    internalDfd    = when.defer(),</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">119</td>
      <td class="content">+    externalDfd    = when.defer(),</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">120</td>
      <td class="content">+    dataDfd        = when.defer(),</td>
    </tr>
    <tr class="normal">
      <td class="line">114</td>
      <td class="line">121</td>
      <td class="content">     $body          = $('body'),</td>
    </tr>
    <tr class="normal">
      <td class="line">115</td>
      <td class="line">122</td>
      <td class="content">     $parent        = $('<span id="' + NAMESPACE + '-elements-container"></span>'),</td>
    </tr>
    <tr class="normal">
      <td class="line">116</td>
      <td class="line">123</td>
      <td class="content">     events         = [],</td>
    </tr>
    <tr class="normal">
      <td class="line">115</td>
      <td class="line">122</td>
      <td class="content">     $parent        = $('<span id="' + NAMESPACE + '-elements-container"></span>'),</td>
    </tr>
    <tr class="normal">
      <td class="line">116</td>
      <td class="line">123</td>
      <td class="content">     events         = [],</td>
    </tr>
    <tr class="normal">
      <td class="line">117</td>
      <td class="line">124</td>
      <td class="content">     data           = {},</td>
    </tr>
    <tr class="del">
      <td class="line">118</td>
      <td class="line"></td>
      <td class="content">-    log            = new Logger('tracking_api.signal'),</td>
    </tr>
    <tr class="del">
      <td class="line">119</td>
      <td class="line"></td>
      <td class="content">-    eventsToFire   = [];</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">125</td>
      <td class="content">+    log            = new Logger('tracking_api.signal');</td>
    </tr>
    <tr class="normal">
      <td class="line">120</td>
      <td class="line">126</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">121</td>
      <td class="line">127</td>
      <td class="content">   /**</td>
    </tr>
    <tr class="normal">
      <td class="line">122</td>
      <td class="line">128</td>
      <td class="content">    * Creates a global method that will allow access to Signal data.</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -159,8 +165,12 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">159</td>
      <td class="line">165</td>
      <td class="content">    *</td>
    </tr>
    <tr class="normal">
      <td class="line">160</td>
      <td class="line">166</td>
      <td class="content">    * @method  collectPageData</td>
    </tr>
    <tr class="normal">
      <td class="line">161</td>
      <td class="line">167</td>
      <td class="content">    * @private</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">168</td>
      <td class="content">+   *</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">169</td>
      <td class="content">+   * @return  {Promise}  A promise resolved when the data has been added</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">172</td>
      <td class="content">+    var dfd = when.defer();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">173</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">164</td>
      <td class="line">174</td>
      <td class="content">     pageController.add(function (props) {</td>
    </tr>
    <tr class="normal">
      <td class="line">165</td>
      <td class="line">175</td>
      <td class="content">       log.info('Signal common.page_controller function callback');</td>
    </tr>
    <tr class="normal">
      <td class="line">166</td>
      <td class="line">176</td>
      <td class="content">       data.userId = props.vendorUserId ? props.vendorUserId : '';</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -169,7 +179,11 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">169</td>
      <td class="line">179</td>
      <td class="content">       data.saleName = props.saleName || (props.sale ? props.sale.name : (props.uniqueKey || '')); // Ideal, then Swift, then Home</td>
    </tr>
    <tr class="normal">
      <td class="line">170</td>
      <td class="line">180</td>
      <td class="content">       data.productName = props.productName || (props.product ? props.product.name : ''); // Ideal, then Swift and Home</td>
    </tr>
    <tr class="normal">
      <td class="line">171</td>
      <td class="line">181</td>
      <td class="content">       data.productLookId = props.productLookId || (props.look ? props.look.product_look_id : ''); // Ideal, then Swift and Home</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">182</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">183</td>
      <td class="content">+      dfd.resolve();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">185</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">186</td>
      <td class="content">+    return dfd.promise;</td>
    </tr>
    <tr class="normal">
      <td class="line">173</td>
      <td class="line">187</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">174</td>
      <td class="line">188</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">175</td>
      <td class="line">189</td>
      <td class="content">   /**</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -206,21 +220,6 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">206</td>
      <td class="line">220</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">207</td>
      <td class="line">221</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">208</td>
      <td class="line">222</td>
      <td class="content">   /**</td>
    </tr>
    <tr class="del">
      <td class="line">209</td>
      <td class="line"></td>
      <td class="content">-   * Flushes the events queue when Signal is ready</td>
    </tr>
    <tr class="del">
      <td class="line">210</td>
      <td class="line"></td>
      <td class="content">-   *</td>
    </tr>
    <tr class="del">
      <td class="line">211</td>
      <td class="line"></td>
      <td class="content">-   * @method  flushQueue</td>
    </tr>
    <tr class="del">
      <td class="line">212</td>
      <td class="line"></td>
      <td class="content">-   * @private</td>
    </tr>
    <tr class="del">
      <td class="line">213</td>
      <td class="line"></td>
      <td class="content">-   */</td>
    </tr>
    <tr class="del">
      <td class="line">214</td>
      <td class="line"></td>
      <td class="content">-  function flushEvents () {</td>
    </tr>
    <tr class="del">
      <td class="line">215</td>
      <td class="line"></td>
      <td class="content">-    log.info('Signal will now flush all queued events');</td>
    </tr>
    <tr class="del">
      <td class="line">216</td>
      <td class="line"></td>
      <td class="content">-    for (var i = 0; i < eventsToFire.length; i += 1) {</td>
    </tr>
    <tr class="del">
      <td class="line">217</td>
      <td class="line"></td>
      <td class="content">-      if (typeof eventsToFire[i] === 'function') {</td>
    </tr>
    <tr class="del">
      <td class="line">218</td>
      <td class="line"></td>
      <td class="content">-        eventsToFire[i]();</td>
    </tr>
    <tr class="del">
      <td class="line">219</td>
      <td class="line"></td>
      <td class="content">-      }</td>
    </tr>
    <tr class="del">
      <td class="line">220</td>
      <td class="line"></td>
      <td class="content">-    }</td>
    </tr>
    <tr class="del">
      <td class="line">221</td>
      <td class="line"></td>
      <td class="content">-  }</td>
    </tr>
    <tr class="del">
      <td class="line">222</td>
      <td class="line"></td>
      <td class="content">-</td>
    </tr>
    <tr class="del">
      <td class="line">223</td>
      <td class="line"></td>
      <td class="content">-  /**</td>
    </tr>
    <tr class="normal">
      <td class="line">224</td>
      <td class="line">223</td>
      <td class="content">    * Creates a new event and adds it to the event store without triggering.</td>
    </tr>
    <tr class="normal">
      <td class="line">225</td>
      <td class="line">224</td>
      <td class="content">    * Trigger the event later with fireEvent();</td>
    </tr>
    <tr class="normal">
      <td class="line">226</td>
      <td class="line">225</td>
      <td class="content">    *</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -239,7 +238,6 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">239</td>
      <td class="line">238</td>
      <td class="content">       log.info('Creating Signal event "%s"', label);</td>
    </tr>
    <tr class="normal">
      <td class="line">240</td>
      <td class="line">239</td>
      <td class="content">       var $el = $('<span style="display:none;" id="' + NAMESPACE + '-' + label + '">' + label + '</span>');</td>
    </tr>
    <tr class="normal">
      <td class="line">241</td>
      <td class="line">240</td>
      <td class="content">       $parent.append($el);</td>
    </tr>
    <tr class="del">
      <td class="line">242</td>
      <td class="line"></td>
      <td class="content">-      events.push(label);</td>
    </tr>
    <tr class="normal">
      <td class="line">243</td>
      <td class="line">241</td>
      <td class="content">     }</td>
    </tr>
    <tr class="normal">
      <td class="line">244</td>
      <td class="line">242</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">245</td>
      <td class="line">243</td>
      <td class="content"> </td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -275,11 +273,11 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">275</td>
      <td class="line">273</td>
      <td class="content">       createEvent(label);</td>
    </tr>
    <tr class="normal">
      <td class="line">276</td>
      <td class="line">274</td>
      <td class="content">     }</td>
    </tr>
    <tr class="normal">
      <td class="line">277</td>
      <td class="line">275</td>
      <td class="content"> </td>
    </tr>
    <tr class="del">
      <td class="line">278</td>
      <td class="line"></td>
      <td class="content">-    if (signalReady) {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">276</td>
      <td class="content">+    when.all([dataDfd.promise,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">277</td>
      <td class="content">+              internalDfd.promise,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">278</td>
      <td class="content">+              externalDfd.promise]).then(function () {</td>
    </tr>
    <tr class="del">
      <td class="line">280</td>
      <td class="line"></td>
      <td class="content">-    } else {</td>
    </tr>
    <tr class="del">
      <td class="line">281</td>
      <td class="line"></td>
      <td class="content">-      eventsToFire.push(eventFn);</td>
    </tr>
    <tr class="del">
      <td class="line">282</td>
      <td class="line"></td>
      <td class="content">-    }</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">280</td>
      <td class="content">+    });</td>
    </tr>
    <tr class="normal">
      <td class="line">283</td>
      <td class="line">281</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">284</td>
      <td class="line">282</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">285</td>
      <td class="line">283</td>
      <td class="content">   /**</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -342,21 +340,20 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">342</td>
      <td class="line">340</td>
      <td class="content">       return;</td>
    </tr>
    <tr class="normal">
      <td class="line">343</td>
      <td class="line">341</td>
      <td class="content">     }</td>
    </tr>
    <tr class="normal">
      <td class="line">344</td>
      <td class="line">342</td>
      <td class="content"> </td>
    </tr>
    <tr class="del">
      <td class="line">345</td>
      <td class="line"></td>
      <td class="content">-    $(function () {</td>
    </tr>
    <tr class="del">
      <td class="line">346</td>
      <td class="line"></td>
      <td class="content">-      if (!initialized && $body.length) {</td>
    </tr>
    <tr class="del">
      <td class="line">347</td>
      <td class="line"></td>
      <td class="content">-        log.info('Initializing Signal');</td>
    </tr>
    <tr class="del">
      <td class="line">348</td>
      <td class="line"></td>
      <td class="content">-        leakGlobal();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">343</td>
      <td class="content">+    log.info('Initializing Signal');</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">344</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">345</td>
      <td class="content">+    leakGlobal();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">346</td>
      <td class="content">+    buildElementForEvents();</td>
    </tr>
    <tr class="del">
      <td class="line">350</td>
      <td class="line"></td>
      <td class="content">-        if (!document.getElementById('gilt-signal-script')) {</td>
    </tr>
    <tr class="del">
      <td class="line">351</td>
      <td class="line"></td>
      <td class="content">-          addVendorScript();</td>
    </tr>
    <tr class="del">
      <td class="line">352</td>
      <td class="line"></td>
      <td class="content">-        }</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">348</td>
      <td class="content">+    collectPageData().then(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">349</td>
      <td class="content">+      dataDfd.resolve();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">350</td>
      <td class="content">+      internalDfd.resolve();</td>
    </tr>
    <tr class="del">
      <td class="line">354</td>
      <td class="line"></td>
      <td class="content">-        buildElementForEvents();</td>
    </tr>
    <tr class="del">
      <td class="line">355</td>
      <td class="line"></td>
      <td class="content">-        collectPageData();</td>
    </tr>
    <tr class="del">
      <td class="line">356</td>
      <td class="line"></td>
      <td class="content">-        initialized = true;</td>
    </tr>
    <tr class="del">
      <td class="line">357</td>
      <td class="line"></td>
      <td class="content">-      } else {</td>
    </tr>
    <tr class="del">
      <td class="line">358</td>
      <td class="line"></td>
      <td class="content">-        log.warn('Signal is either already initialized or there is no <body> element available');</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">352</td>
      <td class="content">+      if (!document.getElementById('gilt-signal-script')) {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">353</td>
      <td class="content">+        addVendorScript();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">355</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">356</td>
      <td class="content">+      readyDfd.resolve();</td>
    </tr>
    <tr class="normal">
      <td class="line">360</td>
      <td class="line">357</td>
      <td class="content">     });</td>
    </tr>
    <tr class="normal">
      <td class="line">361</td>
      <td class="line">358</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">362</td>
      <td class="line">359</td>
      <td class="content"> </td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -366,25 +363,25 @@ function (</td>
    </tr>
    <tr class="normal">
      <td class="line">366</td>
      <td class="line">363</td>
      <td class="content">    * fire the events, someone is listening to them. Must only be called from</td>
    </tr>
    <tr class="normal">
      <td class="line">367</td>
      <td class="line">364</td>
      <td class="content">    * Signal's dashboard itself, never in Gilt code.</td>
    </tr>
    <tr class="normal">
      <td class="line">368</td>
      <td class="line">365</td>
      <td class="content">    *</td>
    </tr>
    <tr class="del">
      <td class="line">369</td>
      <td class="line"></td>
      <td class="content">-   * @method ready</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">366</td>
      <td class="content">+   * @method tagReady</td>
    </tr>
    <tr class="normal">
      <td class="line">370</td>
      <td class="line">367</td>
      <td class="content">    * @public</td>
    </tr>
    <tr class="normal">
      <td class="line">371</td>
      <td class="line">368</td>
      <td class="content">    *</td>
    </tr>
    <tr class="normal">
      <td class="line">372</td>
      <td class="line">369</td>
      <td class="content">    * @example</td>
    </tr>
    <tr class="normal">
      <td class="line">370</td>
      <td class="line">367</td>
      <td class="content">    * @public</td>
    </tr>
    <tr class="normal">
      <td class="line">371</td>
      <td class="line">368</td>
      <td class="content">    *</td>
    </tr>
    <tr class="normal">
      <td class="line">372</td>
      <td class="line">369</td>
      <td class="content">    * @example</td>
    </tr>
    <tr class="del">
      <td class="line">373</td>
      <td class="line"></td>
      <td class="content">-   *   signal.ready(); // DO NOT USE EXCEPT IN THE SIGNAL DASHBOARD!</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">370</td>
      <td class="content">+   *   signal.tagReady(); // DO NOT USE EXCEPT IN THE SIGNAL DASHBOARD!</td>
    </tr>
    <tr class="del">
      <td class="line">375</td>
      <td class="line"></td>
      <td class="content">-  function ready () {</td>
    </tr>
    <tr class="del">
      <td class="line">376</td>
      <td class="line"></td>
      <td class="content">-    log.info('Signal ready function fired, hopefully from the Signal dashboard!');</td>
    </tr>
    <tr class="del">
      <td class="line">377</td>
      <td class="line"></td>
      <td class="content">-    signalReady = true;</td>
    </tr>
    <tr class="del">
      <td class="line">378</td>
      <td class="line"></td>
      <td class="content">-    flushEvents();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">372</td>
      <td class="content">+  function tagReady () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">373</td>
      <td class="content">+    log.info('Signal tagReady function fired, hopefully from the Signal dashboard!');</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">374</td>
      <td class="content">+    externalDfd.resolve();</td>
    </tr>
    <tr class="normal">
      <td class="line">379</td>
      <td class="line">375</td>
      <td class="content">   }</td>
    </tr>
    <tr class="normal">
      <td class="line">380</td>
      <td class="line">376</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">381</td>
      <td class="line">377</td>
      <td class="content">   return {</td>
    </tr>
    <tr class="normal">
      <td class="line">380</td>
      <td class="line">376</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">381</td>
      <td class="line">377</td>
      <td class="content">   return {</td>
    </tr>
    <tr class="normal">
      <td class="line">382</td>
      <td class="line">378</td>
      <td class="content">     version     : '$$PACKAGE_VERSION$$',</td>
    </tr>
    <tr class="del">
      <td class="line">383</td>
      <td class="line"></td>
      <td class="content">-    init        : init,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">379</td>
      <td class="content">+    init        : _.once(init),</td>
    </tr>
    <tr class="del">
      <td class="line">386</td>
      <td class="line"></td>
      <td class="content">-    ready       : ready,</td>
    </tr>
    <tr class="del">
      <td class="line">387</td>
      <td class="line"></td>
      <td class="content">-    getData     : getData</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">382</td>
      <td class="content">+    tagReady    : tagReady,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">383</td>
      <td class="content">+    getData     : getData,</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">384</td>
      <td class="content">+    ready       : readyDfd.promise</td>
    </tr>
    <tr class="normal">
      <td class="line">388</td>
      <td class="line">385</td>
      <td class="content">   };</td>
    </tr>
    <tr class="normal">
      <td class="line">389</td>
      <td class="line">386</td>
      <td class="content"> },</td>
    </tr>
    <tr class="normal">
      <td class="line">390</td>
      <td class="line">387</td>
      <td class="content"> </td>
    </tr>
  </tbody>
  </table>
</div>

<a name="src&#x2F;tracking_api&#x2F;signal&#x2F;package.json"></a>
<div class="fileHeader">
  <span class="total">5</span>
  <span class="graph" title="3 additions & 2 deletions">
    <span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="del">■</span><span class="del">■</span>
  </span>
  <span class="name">src&#x2F;tracking_api&#x2F;signal&#x2F;package.json</span>
</div>
<div class="diff">
  <table cellpadding="0" cellspacing="0" border="0">
  <tbody>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -1,7 +1,7 @@</td>
    </tr>
    <tr class="normal">
      <td class="line">1</td>
      <td class="line">1</td>
      <td class="content"> {</td>
    </tr>
    <tr class="normal">
      <td class="line">2</td>
      <td class="line">2</td>
      <td class="content">   "name": "tracking_api.signal",</td>
    </tr>
    <tr class="normal">
      <td class="line">3</td>
      <td class="line">3</td>
      <td class="content">   "group": "tracking_api",</td>
    </tr>
    <tr class="del">
      <td class="line">4</td>
      <td class="line"></td>
      <td class="content">-  "version": "1.0.2",</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">4</td>
      <td class="content">+  "version": "2.0.0",</td>
    </tr>
    <tr class="normal">
      <td class="line">5</td>
      <td class="line">5</td>
      <td class="content">   "description": "The interface to the Signal (formerly BrightTag) tag container.",</td>
    </tr>
    <tr class="normal">
      <td class="line">6</td>
      <td class="line">6</td>
      <td class="content">   "repositories": [</td>
    </tr>
    <tr class="normal">
      <td class="line">7</td>
      <td class="line">7</td>
      <td class="content">     {</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -27,7 +27,8 @@</td>
    </tr>
    <tr class="normal">
      <td class="line">27</td>
      <td class="line">27</td>
      <td class="content">     "common.page_controller": "2.x.x",</td>
    </tr>
    <tr class="normal">
      <td class="line">28</td>
      <td class="line">28</td>
      <td class="content">     "common.string_utils": "1.x.x",</td>
    </tr>
    <tr class="normal">
      <td class="line">29</td>
      <td class="line">29</td>
      <td class="content">     "vendor.jquery": "1.10.x",</td>
    </tr>
    <tr class="del">
      <td class="line">30</td>
      <td class="line"></td>
      <td class="content">-    "vendor.underscore": "1.3.x"</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">30</td>
      <td class="content">+    "vendor.underscore": "1.3.x",</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">31</td>
      <td class="content">+    "vendor.when": "2.2.x"</td>
    </tr>
    <tr class="normal">
      <td class="line">31</td>
      <td class="line">32</td>
      <td class="content">   },</td>
    </tr>
    <tr class="normal">
      <td class="line">32</td>
      <td class="line">33</td>
      <td class="content">   "configDependencies": {</td>
    </tr>
    <tr class="normal">
      <td class="line">33</td>
      <td class="line">34</td>
      <td class="content">     "config.signal_script_uri": "//s.btstatic.com/tag.js",</td>
    </tr>
  </tbody>
  </table>
</div>

<a name="src&#x2F;tracking_api&#x2F;signal&#x2F;spec&#x2F;signal.js"></a>
<div class="fileHeader">
  <span class="total">89</span>
  <span class="graph" title="67 additions & 22 deletions">
    <span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="add">■</span><span class="del">■</span>
  </span>
  <span class="name">src&#x2F;tracking_api&#x2F;signal&#x2F;spec&#x2F;signal.js</span>
</div>
<div class="diff">
  <table cellpadding="0" cellspacing="0" border="0">
  <tbody>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -1,82 +1,127 @@</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -1,82 +1,127 @@</td>
    </tr>
    <tr class="del">
      <td class="line">1</td>
      <td class="line"></td>
      <td class="content">-requireSpecs(['vendor.jquery', 'tracking_api.signal'], function ($, signal) {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">1</td>
      <td class="content">+requireSpecs([</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">2</td>
      <td class="content">+  'vendor.jquery',</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">3</td>
      <td class="content">+  'tracking_api.signal',</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">4</td>
      <td class="content">+  'common.page_controller',</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">5</td>
      <td class="content">+  'vendor.when'</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">6</td>
      <td class="content">+], function ($, signal, pageController, when) {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">7</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">8</td>
      <td class="content">+  pageController.init({</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">9</td>
      <td class="content">+    section: 'men'</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">10</td>
      <td class="content">+  });</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">11</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">12</td>
      <td class="content">+  pageController.ready = when.resolve();</td>
    </tr>
    <tr class="normal">
      <td class="line">2</td>
      <td class="line">13</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">3</td>
      <td class="line">14</td>
      <td class="content">   describe('Signal', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">4</td>
      <td class="line">15</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">2</td>
      <td class="line">13</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">3</td>
      <td class="line">14</td>
      <td class="content">   describe('Signal', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">4</td>
      <td class="line">15</td>
      <td class="content"> </td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">16</td>
      <td class="content">+    signal.init();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">17</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">5</td>
      <td class="line">18</td>
      <td class="content">     if (targetExperience === 'full') { // We only include Signal in Full</td>
    </tr>
    <tr class="normal">
      <td class="line">6</td>
      <td class="line">19</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">7</td>
      <td class="line">20</td>
      <td class="content">       it('should queue up events but not fire them until ready is called', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">6</td>
      <td class="line">19</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">7</td>
      <td class="line">20</td>
      <td class="content">       it('should queue up events but not fire them until ready is called', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">8</td>
      <td class="line">21</td>
      <td class="content">         var testValue = false;</td>
    </tr>
    <tr class="del">
      <td class="line">9</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-0"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">10</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-0').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">22</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">23</td>
      <td class="content">+        $('body').on('click', '#signal-test-0', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">26</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">13</td>
      <td class="line">27</td>
      <td class="content">         signal.createEvent('test-0');</td>
    </tr>
    <tr class="normal">
      <td class="line">14</td>
      <td class="line">28</td>
      <td class="content">         signal.fireEvent('test-0');</td>
    </tr>
    <tr class="normal">
      <td class="line">15</td>
      <td class="line">29</td>
      <td class="content">         expect(testValue).toBe(false);</td>
    </tr>
    <tr class="normal">
      <td class="line">13</td>
      <td class="line">27</td>
      <td class="content">         signal.createEvent('test-0');</td>
    </tr>
    <tr class="normal">
      <td class="line">14</td>
      <td class="line">28</td>
      <td class="content">         signal.fireEvent('test-0');</td>
    </tr>
    <tr class="normal">
      <td class="line">15</td>
      <td class="line">29</td>
      <td class="content">         expect(testValue).toBe(false);</td>
    </tr>
    <tr class="del">
      <td class="line">16</td>
      <td class="line"></td>
      <td class="content">-        signal.ready();</td>
    </tr>
    <tr class="del">
      <td class="line">17</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">30</td>
      <td class="content">+        signal.tagReady();</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">31</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">32</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">33</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">34</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">35</td>
      <td class="content">+          expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">36</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">18</td>
      <td class="line">37</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">19</td>
      <td class="line">38</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">20</td>
      <td class="line">39</td>
      <td class="content">       it('should respond to click events', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">19</td>
      <td class="line">38</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">20</td>
      <td class="line">39</td>
      <td class="content">       it('should respond to click events', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">21</td>
      <td class="line">40</td>
      <td class="content">         var testValue = false;</td>
    </tr>
    <tr class="del">
      <td class="line">22</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-1"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">23</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-1').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">41</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">42</td>
      <td class="content">+        $('body').on('click', "#signal-test-1", function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">45</td>
      <td class="content">+</td>
    </tr>
    <tr class="del">
      <td class="line">28</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">48</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">49</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">50</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">51</td>
      <td class="content">+          expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">52</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">29</td>
      <td class="line">53</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">30</td>
      <td class="line">54</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">31</td>
      <td class="line">55</td>
      <td class="content">       it('should create an event if it does not already exist', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">30</td>
      <td class="line">54</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">31</td>
      <td class="line">55</td>
      <td class="content">       it('should create an event if it does not already exist', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">32</td>
      <td class="line">56</td>
      <td class="content">         var testValue = false;</td>
    </tr>
    <tr class="del">
      <td class="line">33</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-2"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">34</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-2').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">57</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">58</td>
      <td class="content">+        $('body').on('click', '#signal-test-2', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">61</td>
      <td class="content">+</td>
    </tr>
    <tr class="del">
      <td class="line">38</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">63</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">64</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">65</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">66</td>
      <td class="content">+          expect(testValue).toBe(true);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">67</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">39</td>
      <td class="line">68</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">40</td>
      <td class="line">69</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">41</td>
      <td class="line">70</td>
      <td class="content">       it('should create an event only once', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">40</td>
      <td class="line">69</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">41</td>
      <td class="line">70</td>
      <td class="content">       it('should create an event only once', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">42</td>
      <td class="line">71</td>
      <td class="content">         var testValue = 0;</td>
    </tr>
    <tr class="del">
      <td class="line">43</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-3"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">44</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-3').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">72</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">73</td>
      <td class="content">+        $('body').on('click', '#signal-test-3', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">76</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">47</td>
      <td class="line">77</td>
      <td class="content">         signal.createEvent('test-3');</td>
    </tr>
    <tr class="normal">
      <td class="line">48</td>
      <td class="line">78</td>
      <td class="content">         signal.createEvent('test-3');</td>
    </tr>
    <tr class="normal">
      <td class="line">49</td>
      <td class="line">79</td>
      <td class="content">         signal.fireEvent('test-3');</td>
    </tr>
    <tr class="normal">
      <td class="line">47</td>
      <td class="line">77</td>
      <td class="content">         signal.createEvent('test-3');</td>
    </tr>
    <tr class="normal">
      <td class="line">48</td>
      <td class="line">78</td>
      <td class="content">         signal.createEvent('test-3');</td>
    </tr>
    <tr class="normal">
      <td class="line">49</td>
      <td class="line">79</td>
      <td class="content">         signal.fireEvent('test-3');</td>
    </tr>
    <tr class="del">
      <td class="line">50</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(1);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">80</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">81</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">82</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">83</td>
      <td class="content">+          expect(testValue).toBe(1);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">84</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">51</td>
      <td class="line">85</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">52</td>
      <td class="line">86</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">53</td>
      <td class="line">87</td>
      <td class="content">       it('should fire events multiple times', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">52</td>
      <td class="line">86</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">53</td>
      <td class="line">87</td>
      <td class="content">       it('should fire events multiple times', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">54</td>
      <td class="line">88</td>
      <td class="content">         var testValue = 0;</td>
    </tr>
    <tr class="del">
      <td class="line">55</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-4"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">56</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-4').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">89</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">90</td>
      <td class="content">+        $('body').on('click', '#signal-test-4', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">93</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">59</td>
      <td class="line">94</td>
      <td class="content">         signal.createEvent('test-4');</td>
    </tr>
    <tr class="normal">
      <td class="line">60</td>
      <td class="line">95</td>
      <td class="content">         signal.fireEvent('test-4');</td>
    </tr>
    <tr class="normal">
      <td class="line">61</td>
      <td class="line">96</td>
      <td class="content">         signal.fireEvent('test-4');</td>
    </tr>
    <tr class="normal">
      <td class="line">59</td>
      <td class="line">94</td>
      <td class="content">         signal.createEvent('test-4');</td>
    </tr>
    <tr class="normal">
      <td class="line">60</td>
      <td class="line">95</td>
      <td class="content">         signal.fireEvent('test-4');</td>
    </tr>
    <tr class="normal">
      <td class="line">61</td>
      <td class="line">96</td>
      <td class="content">         signal.fireEvent('test-4');</td>
    </tr>
    <tr class="del">
      <td class="line">62</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(2);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">97</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">98</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">99</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">100</td>
      <td class="content">+          expect(testValue).toBe(2);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">101</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">63</td>
      <td class="line">102</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">64</td>
      <td class="line">103</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">65</td>
      <td class="line">104</td>
      <td class="content">       it('should automatically cast event names', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">64</td>
      <td class="line">103</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">65</td>
      <td class="line">104</td>
      <td class="content">       it('should automatically cast event names', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">66</td>
      <td class="line">105</td>
      <td class="content">         var testValue = 0;</td>
    </tr>
    <tr class="del">
      <td class="line">67</td>
      <td class="line"></td>
      <td class="content">-        $('body').append('<span id="signal-test-5"></span>');</td>
    </tr>
    <tr class="del">
      <td class="line">68</td>
      <td class="line"></td>
      <td class="content">-        $('#signal-test-5').bind('click', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">106</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">107</td>
      <td class="content">+        $('body').on('click', '#signal-test-5', function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">110</td>
      <td class="content">+</td>
    </tr>
    <tr class="normal">
      <td class="line">71</td>
      <td class="line">111</td>
      <td class="content">         signal.createEvent('test_5');</td>
    </tr>
    <tr class="normal">
      <td class="line">72</td>
      <td class="line">112</td>
      <td class="content">         signal.fireEvent('test-5');</td>
    </tr>
    <tr class="normal">
      <td class="line">73</td>
      <td class="line">113</td>
      <td class="content">         signal.fireEvent('test_5');</td>
    </tr>
    <tr class="normal">
      <td class="line">72</td>
      <td class="line">112</td>
      <td class="content">         signal.fireEvent('test-5');</td>
    </tr>
    <tr class="normal">
      <td class="line">73</td>
      <td class="line">113</td>
      <td class="content">         signal.fireEvent('test_5');</td>
    </tr>
    <tr class="normal">
      <td class="line">74</td>
      <td class="line">114</td>
      <td class="content">         signal.fireEvent('test5');</td>
    </tr>
    <tr class="del">
      <td class="line">75</td>
      <td class="line"></td>
      <td class="content">-        expect(testValue).toBe(3);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">115</td>
      <td class="content">+</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">116</td>
      <td class="content">+        waits(50);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">117</td>
      <td class="content">+        runs(function () {</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">118</td>
      <td class="content">+          expect(testValue).toBe(3);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">119</td>
      <td class="content">+        });</td>
    </tr>
    <tr class="normal">
      <td class="line">76</td>
      <td class="line">120</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">77</td>
      <td class="line">121</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">78</td>
      <td class="line">122</td>
      <td class="content">       it('should allow access to data through a global', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">76</td>
      <td class="line">120</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">77</td>
      <td class="line">121</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">78</td>
      <td class="line">122</td>
      <td class="content">       it('should allow access to data through a global', function () {</td>
    </tr>
    <tr class="del">
      <td class="line">79</td>
      <td class="line"></td>
      <td class="content">-        // TODO: No data is available</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">123</td>
      <td class="content">+        expect(signalData.get('section')).toBe('men');</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">124</td>
      <td class="content">+        expect(signal.getData('section')).toBe('men');</td>
    </tr>
    <tr class="normal">
      <td class="line">80</td>
      <td class="line">125</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">81</td>
      <td class="line">126</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">82</td>
      <td class="line">127</td>
      <td class="content">     } else { // Minimal and Intermediate just get stubs...</td>
    </tr>
    <tr class="chunk">
      <td class="line"></td>
      <td class="line"></td>
      <td class="content">@@ -84,7 +129,7 @@ requireSpecs(['vendor.jquery', 'tracking_api.signal'], function ($, signal) {</td>
    </tr>
    <tr class="normal">
      <td class="line">84</td>
      <td class="line">129</td>
      <td class="content">       it('should have stubs for all API functions', function () {</td>
    </tr>
    <tr class="normal">
      <td class="line">85</td>
      <td class="line">130</td>
      <td class="content">         expect(signal.createEvent('foo-0')).toBe(undefined);</td>
    </tr>
    <tr class="normal">
      <td class="line">86</td>
      <td class="line">131</td>
      <td class="content">         expect(signal.fireEvent('foo-1')).toBe(undefined);</td>
    </tr>
    <tr class="del">
      <td class="line">87</td>
      <td class="line"></td>
      <td class="content">-        expect(signal.ready()).toBe(undefined);</td>
    </tr>
    <tr class="add">
      <td class="line"></td>
      <td class="line">132</td>
      <td class="content">+        expect(signal.tagReady()).toBe(undefined);</td>
    </tr>
    <tr class="normal">
      <td class="line">88</td>
      <td class="line">133</td>
      <td class="content">       });</td>
    </tr>
    <tr class="normal">
      <td class="line">89</td>
      <td class="line">134</td>
      <td class="content"> </td>
    </tr>
    <tr class="normal">
      <td class="line">90</td>
      <td class="line">135</td>
      <td class="content">       it('should return an empty string for data objects', function () {</td>
    </tr>
  </tbody>
  </table>
</div>

